<UserControl x:Class="VMS.VisionSetup.Views.Recipe.RecipeEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Background="#252526" Foreground="White"
             d:DesignHeight="600" d:DesignWidth="800">

    <UserControl.Resources>
        <Style x:Key="EditorButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="11"/>
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#555555"/>
                    <Setter Property="Foreground" Value="#999999"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1084D8"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SecondaryButtonStyle" TargetType="Button" BasedOn="{StaticResource EditorButtonStyle}">
            <Setter Property="Background" Value="#3E3E42"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#505054"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DangerButtonStyle" TargetType="Button" BasedOn="{StaticResource EditorButtonStyle}">
            <Setter Property="Background" Value="#D32F2F"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E53935"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#CCCCCC"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Margin" Value="0,0,0,3"/>
        </Style>

        <Style x:Key="InputStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#3E3E42"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>

        <Style x:Key="TreeViewItemStyle" TargetType="TreeViewItem">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="Margin" Value="0,1"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#0078D4"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3E3E42"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with Recipe Info -->
        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock x:Name="RecipeNameText" Text="No Recipe Loaded"
                           Foreground="#FFD700" FontWeight="Bold" FontSize="16"/>
                <TextBlock x:Name="RecipeInfoText" Text=""
                           Foreground="#888888" FontSize="11" Margin="0,3,0,0"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Content="Save" x:Name="SaveButton" Click="SaveRecipe_Click"
                        Style="{StaticResource EditorButtonStyle}" Width="70" IsEnabled="False"/>
                <Button Content="Discard" x:Name="DiscardButton" Click="DiscardChanges_Click"
                        Style="{StaticResource SecondaryButtonStyle}" Width="70" IsEnabled="False"/>
            </StackPanel>
        </Grid>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Tree View Panel -->
            <Grid Grid.Column="0" Margin="0,0,10,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TreeView x:Name="RecipeTree" Grid.Row="0"
                          Background="#2D2D30" BorderBrush="#555555" BorderThickness="1"
                          SelectedItemChanged="RecipeTree_SelectedItemChanged">
                </TreeView>

                <!-- Tree Actions -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,0">
                    <Button Content="Add Step" x:Name="AddStepButton" Click="AddStep_Click"
                            Style="{StaticResource EditorButtonStyle}" Width="70" IsEnabled="False"/>
                    <Button Content="Add Tool" x:Name="AddToolButton" Click="AddTool_Click"
                            Style="{StaticResource EditorButtonStyle}" Width="70" IsEnabled="False"/>
                    <Button Content="Remove" x:Name="RemoveButton" Click="RemoveSelected_Click"
                            Style="{StaticResource DangerButtonStyle}" Width="65" IsEnabled="False"/>
                </StackPanel>
            </Grid>

            <!-- Properties Panel -->
            <Border Grid.Column="1" Background="#2D2D30" BorderBrush="#555555" BorderThickness="1" Padding="15">
                <Grid x:Name="PropertiesPanel">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock x:Name="PropertiesTitle" Grid.Row="0" Text="Properties"
                               Foreground="#FFD700" FontWeight="Bold" FontSize="14"
                               Margin="0,0,0,15"/>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="PropertiesContent">
                            <!-- Recipe Properties (shown when recipe root selected) -->
                            <StackPanel x:Name="RecipePropertiesPanel" Visibility="Collapsed">
                                <TextBlock Text="Recipe Name" Style="{StaticResource LabelStyle}"/>
                                <TextBox x:Name="RecipeNameBox" Style="{StaticResource InputStyle}"
                                         TextChanged="RecipeProperty_Changed"/>

                                <TextBlock Text="Description" Style="{StaticResource LabelStyle}"/>
                                <TextBox x:Name="RecipeDescriptionBox" Style="{StaticResource InputStyle}"
                                         AcceptsReturn="True" Height="60" TextWrapping="Wrap"
                                         TextChanged="RecipeProperty_Changed"/>

                                <TextBlock Text="Version" Style="{StaticResource LabelStyle}"/>
                                <TextBox x:Name="RecipeVersionBox" Style="{StaticResource InputStyle}"
                                         TextChanged="RecipeProperty_Changed"/>

                                <TextBlock Text="Author" Style="{StaticResource LabelStyle}"/>
                                <TextBox x:Name="RecipeAuthorBox" Style="{StaticResource InputStyle}"
                                         TextChanged="RecipeProperty_Changed"/>

                                <TextBlock Text="Used Cameras" Style="{StaticResource LabelStyle}" Margin="0,10,0,5"/>
                                <ListBox x:Name="UsedCamerasList" Height="100"
                                         Background="#3E3E42" BorderBrush="#555555"
                                         Foreground="White" SelectionMode="Multiple"/>
                            </StackPanel>

                            <!-- Step Properties -->
                            <StackPanel x:Name="StepPropertiesPanel" Visibility="Collapsed">
                                <TextBlock Text="Step Name" Style="{StaticResource LabelStyle}"/>
                                <TextBox x:Name="StepNameBox" Style="{StaticResource InputStyle}"
                                         TextChanged="StepProperty_Changed"/>

                                <TextBlock Text="Camera" Style="{StaticResource LabelStyle}"/>
                                <ComboBox x:Name="StepCameraBox"
                                          Background="#3E3E42" Foreground="White"
                                          BorderBrush="#555555" Margin="0,0,0,10"
                                          SelectionChanged="StepProperty_Changed"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Exposure (us)" Style="{StaticResource LabelStyle}"/>
                                        <TextBox x:Name="StepExposureBox" Style="{StaticResource InputStyle}"
                                                 TextChanged="StepProperty_Changed"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Gain" Style="{StaticResource LabelStyle}"/>
                                        <TextBox x:Name="StepGainBox" Style="{StaticResource InputStyle}"
                                                 TextChanged="StepProperty_Changed"/>
                                    </StackPanel>
                                </Grid>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Light Channel" Style="{StaticResource LabelStyle}"/>
                                        <TextBox x:Name="StepLightChannelBox" Style="{StaticResource InputStyle}"
                                                 TextChanged="StepProperty_Changed"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Light Intensity" Style="{StaticResource LabelStyle}"/>
                                        <TextBox x:Name="StepLightIntensityBox" Style="{StaticResource InputStyle}"
                                                 TextChanged="StepProperty_Changed"/>
                                    </StackPanel>
                                </Grid>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <Button Content="Move Up" Click="MoveStepUp_Click"
                                            Style="{StaticResource SecondaryButtonStyle}" Width="70"/>
                                    <Button Content="Move Down" Click="MoveStepDown_Click"
                                            Style="{StaticResource SecondaryButtonStyle}" Width="80"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Tool Properties -->
                            <StackPanel x:Name="ToolPropertiesPanel" Visibility="Collapsed">
                                <TextBlock Text="Tool Name" Style="{StaticResource LabelStyle}"/>
                                <TextBox x:Name="ToolNameBox" Style="{StaticResource InputStyle}"
                                         TextChanged="ToolProperty_Changed"/>

                                <TextBlock Text="Tool Type" Style="{StaticResource LabelStyle}"/>
                                <TextBlock x:Name="ToolTypeText" Foreground="White" FontSize="12"
                                           Margin="0,0,0,10"/>

                                <CheckBox x:Name="ToolEnabledCheckBox" Content="Enabled"
                                          Foreground="White" Margin="0,0,0,10"
                                          Checked="ToolProperty_Changed" Unchecked="ToolProperty_Changed"/>

                                <CheckBox x:Name="ToolUseROICheckBox" Content="Use ROI"
                                          Foreground="White" Margin="0,0,0,10"
                                          Checked="ToolProperty_Changed" Unchecked="ToolProperty_Changed"/>

                                <StackPanel x:Name="ROIPanel">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="10"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="ROI X" Style="{StaticResource LabelStyle}"/>
                                            <TextBox x:Name="ToolROIXBox" Style="{StaticResource InputStyle}"
                                                     TextChanged="ToolProperty_Changed"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="ROI Y" Style="{StaticResource LabelStyle}"/>
                                            <TextBox x:Name="ToolROIYBox" Style="{StaticResource InputStyle}"
                                                     TextChanged="ToolProperty_Changed"/>
                                        </StackPanel>
                                    </Grid>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="10"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="ROI Width" Style="{StaticResource LabelStyle}"/>
                                            <TextBox x:Name="ToolROIWidthBox" Style="{StaticResource InputStyle}"
                                                     TextChanged="ToolProperty_Changed"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="ROI Height" Style="{StaticResource LabelStyle}"/>
                                            <TextBox x:Name="ToolROIHeightBox" Style="{StaticResource InputStyle}"
                                                     TextChanged="ToolProperty_Changed"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>

                                <TextBlock Text="Tool Parameters" Style="{StaticResource LabelStyle}" Margin="0,10,0,5"/>
                                <TextBlock x:Name="ToolParametersInfo" Foreground="#888888" FontSize="10"
                                           TextWrapping="Wrap" Margin="0,0,0,10"/>
                            </StackPanel>

                            <!-- No Selection -->
                            <TextBlock x:Name="NoSelectionText" Text="Select an item to view properties"
                                       Foreground="#888888" FontStyle="Italic"/>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="#2D2D30" Margin="0,10,0,0" Padding="10,5">
            <TextBlock x:Name="StatusText" Foreground="#888888" FontSize="11"/>
        </Border>
    </Grid>
</UserControl>
